# **шпаргалка по REST API**  
*(HTTP-методы, заголовки, структура запросов и ответов)*  

---

## **HTTP-методы (CRUD + дополнительные)**  
| Метод   | Описание                          | Идемпотентность* | Пример использования          |
|---------|-----------------------------------|------------------|-------------------------------|
| `GET`   | Получить данные                   | Да               | `GET /users`                  |
| `POST`  | Создать ресурс                    | Нет              | `POST /users` (с телом)       |
| `PUT`   | Полное обновление ресурса         | Да               | `PUT /users/1` (с телом)      |
| `PATCH` | Частичное обновление              | Нет              | `PATCH /users/1` (с телом)    |
| `DELETE`| Удалить ресурс                    | Да               | `DELETE /users/1`             |
| `HEAD`  | Получить метаданные (без тела)    | Да               | `HEAD /users`                 |
| `OPTIONS`| Получить доступные методы        | Да               | `OPTIONS /users`              |

> **Идемпотентность*** — свойство, при котором повторный запрос даёт тот же результат, что и первый.  

---

## **1. Заголовки запросов (Request Headers)**

### **1.1. Основные заголовки**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Host` | Указывает доменное имя сервера | `Host: api.example.com` |
| `User-Agent` | Идентификатор клиента | `User-Agent: Mozilla/5.0` |
| `Accept` | Указывает допустимые форматы ответа | `Accept: application/json` |
| `Accept-Language` | Предпочитаемый язык ответа | `Accept-Language: en-US` |
| `Accept-Encoding` | Поддерживаемые методы сжатия | `Accept-Encoding: gzip, deflate` |
| `Connection` | Управление соединением | `Connection: keep-alive` |

### **1.2. Заголовки авторизации**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Authorization` | Токен доступа | `Authorization: Bearer xyz123` |
| `API-Key` | Ключ API | `API-Key: abcdef123456` |
| `Cookie` | Куки для аутентификации | `Cookie: session_id=abc123` |

### **1.3. Заголовки содержимого**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Content-Type` | Тип отправляемых данных | `Content-Type: application/json` |
| `Content-Length` | Размер тела запроса в байтах | `Content-Length: 348` |
| `Content-Encoding` | Метод сжатия тела запроса | `Content-Encoding: gzip` |

### **1.4. Специальные заголовки**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `If-Modified-Since` | Запрос только если ресурс изменён | `If-Modified-Since: Tue, 15 Nov 2022 12:00:00 GMT` |
| `If-None-Match` | ETag для проверки кэша | `If-None-Match: "abc123"` |
| `X-Request-ID` | Уникальный ID запроса | `X-Request-ID: 123e4567-e89b-12d3-a456-426614174000` |

## **2. Заголовки ответов (Response Headers)**

### **2.1. Основные заголовки**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Date` | Дата и время ответа | `Date: Tue, 15 Nov 2022 12:00:00 GMT` |
| `Server` | Информация о сервере | `Server: nginx/1.18.0` |
| `Content-Type` | Тип данных в ответе | `Content-Type: application/json` |
| `Content-Length` | Размер тела ответа | `Content-Length: 512` |
| `Content-Encoding` | Метод сжатия ответа | `Content-Encoding: gzip` |

### **2.2. Заголовки кэширования**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Cache-Control` | Управление кэшированием | `Cache-Control: max-age=3600` |
| `ETag` | Хеш ресурса для валидации | `ETag: "abc123"` |
| `Last-Modified` | Дата последнего изменения | `Last-Modified: Tue, 15 Nov 2022 11:00:00 GMT` |
| `Expires` | Срок действия кэша | `Expires: Tue, 15 Nov 2022 13:00:00 GMT` |

### **2.3. Заголовки безопасности**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Access-Control-Allow-Origin` | Настройки CORS | `Access-Control-Allow-Origin: *` |
| `X-Content-Type-Options` | Запрет MIME-sniffing | `X-Content-Type-Options: nosniff` |
| `X-Frame-Options` | Защита от clickjacking | `X-Frame-Options: DENY` |
| `Strict-Transport-Security` | Принудительный HTTPS | `Strict-Transport-Security: max-age=31536000` |

### **2.4. Специальные заголовки**
| Заголовок | Описание | Пример |
|-----------|----------|--------|
| `Location` | URL нового ресурса (для 201) | `Location: /users/123` |
| `Retry-After` | Время повтора запроса | `Retry-After: 120` |
| `X-RateLimit-Limit` | Лимит запросов | `X-RateLimit-Limit: 100` |
| `X-RateLimit-Remaining` | Оставшиеся запросы | `X-RateLimit-Remaining: 95` |

### **Пример полного HTTP-обмена**

#### **Запрос:**
```http
POST /users HTTP/1.1
Host: api.example.com
User-Agent: MyApp/1.0
Content-Type: application/json
Authorization: Bearer xyz123
Content-Length: 56

{"name": "John Doe", "email": "john@example.com"}
```

#### **Ответ:**
```http
HTTP/1.1 201 Created
Date: Tue, 15 Nov 2022 12:00:00 GMT
Server: nginx/1.18.0
Content-Type: application/json
Location: /users/123
Cache-Control: no-cache
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 99
Content-Length: 78

{"id": 123, "name": "John Doe", "email": "john@example.com"}
```

### **Важные рекомендации**

1. **Для JSON API всегда указывайте**:
   ```http
   Accept: application/json
   Content-Type: application/json
   ```

2. **Для безопасности**:
   - Всегда используйте HTTPS
   - Добавляйте `X-Content-Type-Options: nosniff`
   - Реализуйте CORS правильно

3. **Для производительности**:
   - Используйте `Cache-Control` для кэширования
   - Применяйте `Accept-Encoding` для сжатия
   - Используйте `ETag` для валидации кэша

4. **Для отладки**:
   - Добавляйте `X-Request-ID` для трассировки
   - Используйте стандартные заголовки аутентификации

---

## **3.HTTP-коды статус**

HTTP-коды статуса — это трехзначные числа, которые сервер возвращает в ответ на клиентский запрос. Они сгруппированы в 5 классов:

## **3.1. Информационные (1xx)**
*Указывают, что запрос получен и обработка продолжается*

| Код | Название               | Описание                                                                 | Пример использования |
|-----|------------------------|--------------------------------------------------------------------------|-----------------------|
| 100 | Continue               | Сервер получил начальные заголовки, клиент может продолжать отправку тела | Большие файлы POST/PUT |
| 101 | Switching Protocols    | Сервер согласен сменить протокол (напр., на WebSocket)                   | WebSocket соединения  |
| 102 | Processing             | Сервер обрабатывает запрос, но ответ ещё не готов                        | Длительные операции   |
| 103 | Early Hints            | Предварительные заголовки, пока готовится основной ответ                 | Предзагрузка ресурсов |

## **3.2. Успешные (2xx)**
*Указывают на успешное выполнение запроса*

| Код | Название               | Описание                                                                 | Пример использования |
|-----|------------------------|--------------------------------------------------------------------------|-----------------------|
| 200 | OK                     | Стандартный успешный ответ                                               | GET /users            |
| 201 | Created                | Ресурс успешно создан (обычно после POST)                                | POST /users           |
| 202 | Accepted               | Запрос принят, но ещё не обработан                                      | Асинхронные задачи    |
| 204 | No Content             | Нет тела ответа (успех, но ничего не возвращается)                      | DELETE /users/1       |
| 206 | Partial Content        | Возвращена часть контента (для chunked-загрузок)                        | Стриминг видео       |

## **3.3. Перенаправления (3xx)**
*Указывают на необходимость дополнительных действий*

| Код | Название               | Описание                                                                 | Пример использования |
|-----|------------------------|--------------------------------------------------------------------------|-----------------------|
| 301 | Moved Permanently      | Ресурс навсегда перемещён (браузер кэширует)                            | Редирект с HTTP на HTTPS |
| 302 | Found (Moved Temporarily) | Временный редирект (браузер не кэширует)                              | Временное перемещение |
| 304 | Not Modified           | Контент не изменился (используется кэш)                                 | Условные GET-запросы  |
| 307 | Temporary Redirect     | Как 302, но с сохранением метода запроса                                | Временные редиректы API |
| 308 | Permanent Redirect     | Как 301, но с сохранением метода запроса                                | Постоянные редиректы API |

## **3.4. Клиентские ошибки (4xx)**
*Указывают на ошибку со стороны клиента*

| Код | Название               | Описание                                                                 | Пример использования |
|-----|------------------------|--------------------------------------------------------------------------|-----------------------|
| 400 | Bad Request            | Общая ошибка (неверный синтаксис, валидация)                             | Неправильный JSON     |
| 401 | Unauthorized           | Требуется аутентификация (клиент не авторизован)                         | Просмотр без логина   |
| 403 | Forbidden              | Доступ запрещён (даже при аутентификации)                                | Нет прав доступа      |
| 404 | Not Found              | Ресурс не существует                                                    | /non-existent-page    |
| 405 | Method Not Allowed     | Метод не поддерживается для данного URL                                  | PUT для read-only API |
| 429 | Too Many Requests      | Превышен лимит запросов                                                 | API rate limiting     |

## **3.5. Серверные ошибки (5xx)**
*Указывают на ошибку на стороне сервера*

| Код | Название               | Описание                                                                 | Пример использования |
|-----|------------------------|--------------------------------------------------------------------------|-----------------------|
| 500 | Internal Server Error  | Общая серверная ошибка (неожиданная ситуация)                           | Ошибка в коде сервера |
| 502 | Bad Gateway            | Прокси/шлюз получил неверный ответ                                      | Проблемы с балансировщиком |
| 503 | Service Unavailable    | Сервис временно недоступен (перегрузка, техработы)                      | DDoS-атака           |
| 504 | Gateway Timeout        | Прокси/шлюз не дождался ответа                                         | Таймаут соединения   |

## **3.6. Редкие, но полезные коды**

| Код | Название               | Описание                                                                 |
|-----|------------------------|--------------------------------------------------------------------------|
| 402 | Payment Required       | Требуется оплата (используется в некоторых API платежных систем)        |
| 406 | Not Acceptable         | Сервер не может вернуть контент в запрошенном формате (Accept-заголовки)|
| 410 | Gone                   | Ресурс удалён навсегда (в отличие от 404)                               |
| 418 | I'm a teapot           | Шуточный код (из April Fools RFC)                                       |
| 451 | Unavailable For Legal Reasons | Контент недоступен по юридическим причинам                     |


---

## **Советы по работе с REST API**  
1. Всегда проверяйте `Content-Type` и `Accept`.  
2. Для безопасности используйте HTTPS.  
3. Для массовых операций применяйте `PATCH` вместо `PUT`.  
4. Используйте `HEAD` для проверки доступности ресурса.  
5. Документируйте API в Swagger/OpenAPI.  
6. **Безопасность**:
   - Не раскрывайте детали 500-х ошибок в production
   - Используйте стандартные коды (не изобретайте свои)

---
